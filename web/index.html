<!doctype html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <title>轻小说机翻机器人</title>
    <meta name="description" content="一个能自动生成并分享轻小说译文的网站" />
    <link rel="icon" href="/favicon.ico" sizes="32x32" />
    <link rel="icon" href="/icon.svg" type="image/svg+xml" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover"
    />
    <meta name="renderer" content="webkit" />
    <meta name="force-rendering" content="webkit" />
    <meta name="theme-color" content="white" />
    <script>
      (() => {
        function applyTheme(toolbarColor, backgroundColor) {
          document.querySelector("meta[name='theme-color']").content =
            toolbarColor;

          const style = document.createElement('style');
          style.innerHTML = `body { background-color: ${backgroundColor}; }`;
          document.head.appendChild(style);
        }
        function getAndApplyTheme() {
          const reg = [
            /\/novel\/(\w+)\/(\w+)\/(\w+)/,
            /\/workspace\/reader\/(\w+)\/(\w+)/,
          ];
          const isReader = reg.some((r) => r.test(window.location.pathname));
          const setting = localStorage.getItem(
            isReader ? 'readerSetting' : 'setting',
          );
          if (!setting) return;
          const json = JSON.parse(setting);
          let theme = isReader ? json.theme.mode : json.theme;
          if (!theme) theme = 'system';
          if (theme === 'custom') {
            applyTheme(json.theme.bodyColor, json.theme.bodyColor);
          } else if (
            theme === 'dark' ||
            (theme === 'system' &&
              window.matchMedia('(prefers-color-scheme: dark)').matches)
          ) {
            applyTheme('rgb(24, 24, 28)', 'rgb(16, 16, 20)');
          } else {
            applyTheme('white', 'white');
          }
        }
        getAndApplyTheme();
        if (window.history) {
          const oldPushState = history.pushState;
          history.pushState = function pushState() {
            const ret = oldPushState.apply(this, arguments);
            getAndApplyTheme();
            return ret;
          };
          window.addEventListener('popstate', () => {
            getAndApplyTheme();
          });
        }
      })();
    </script>
    <script>
      // vite bug, see https://github.com/vitejs/vite/discussions/15794
      if (!('hasOwn' in Object)) {
        Object.hasOwn = Object.call.bind(Object.hasOwnProperty);
      }
    </script>
  </head>
  <body>
    <div id="fallback-error" style="position: fixed; height: 100vh"></div>
    <script>
      window.onerror = function (msg, url, line, col) {
        if (String(msg).includes('ResizeObserver loop')) {
          return true;
        }

        var div = document.createElement('div');
        div.innerText = `Error: ${line}:${col} ${msg} ${url}`;
        document.getElementById('fallback-error').appendChild(div);
        return false;
      };
    </script>
    <div id="app"></div>
    <script type="module" src="/src/main.ts"></script>
    <noscript>本页面需要浏览器启用JavaScript</noscript>
  </body>
</html>
